trigger:
- main
- staging
- release

parameters:
  - name: Platforms
    type: object
    default:
    - x86
    - x64
    - arm64
  - name: Configurations
    type: object
    default:
    - debug
    - release

variables:
  MSIXVersion: '0.1800'
  solution: '**/GitHubExtension.sln'
  appxPackageDir: 'AppxPackages'

resources:
  repositories:
  - repository: m365Pipelines
    type: git
    name: 1ESPipelineTemplates/M365GPT
    ref: refs/tags/release

pool:
  vmImage: windows-2022

steps:
  - task: NuGetCommand@2
    inputs:
      command: 'restore'
      restoreSolution: '$(solution)'
      feedsToUse: 'config'
      nugetConfigPath: './nuget.config'
  
  - task: MSBuild@1
    inputs:
      solution: '$(solution)'
      msbuildArchitecture: 'x64'
      platform: 'x64'
      configuration: 'release'
      msbuildArguments: '/t:Restore'

  - task: MSBuild@1
    inputs:
      solution: '$(solution)'
      msbuildArchitecture: 'x64'
      platform: 'x64'
      configuration: 'release'
      
  - task: CopyFiles@2
    inputs:
      SourceFolder: './BuildOutput'
      Contents: '**'
      TargetFolder: '$(Build.ArtifactStagingDirectory)'

  - task: PublishBuildArtifacts@1
    inputs:
      PathtoPublish: '$(Build.ArtifactStagingDirectory)'
      ArtifactName: 'drop'
      publishLocation: 'Container'